{% extends "base.html" %}
{% block content %}

<!-- ===============================
     CABECERA INTELIGENTE
================================ -->
<div class="dashboard-hero mb-5">

    <div>
        <h2 class="mb-1">Panel de control</h2>

        {% if current_user.rol == 'admin' %}
            <p class="text-muted">Resumen general de la empresa hoy</p>
        {% elif current_user.rol == 'supervisor' %}
            <p class="text-muted">Actividad del equipo en tiempo real</p>
        {% else %}
            <p class="text-muted">Resumen de tu jornada laboral</p>
        {% endif %}
    </div>

    <div class="today-pill">
        ğŸ“… {{ fecha_hoy }}
    </div>

</div>


<!-- ===============================
     MÃ‰TRICAS PRINCIPALES
================================ -->
<div class="stats-grid mb-5">

    {% if current_user.rol != 'empleado' %}
    <div class="stat-card">
        <div class="stat-number">{{ total_empleados }}</div>
        <div class="stat-label">Empleados activos</div>
    </div>
    {% endif %}

    <div class="stat-card">
        <div class="stat-number">{{ asistencias_hoy }}</div>
        <div class="stat-label">Fichajes hoy</div>
    </div>

    {% if current_user.rol != 'empleado' %}
    <div class="stat-card">
        <div class="stat-number">{{ trabajando }}</div>
        <div class="stat-label">Trabajando ahora</div>
    </div>
    {% endif %}

    <div class="stat-card">
        <div class="stat-number">{{ horas_mes }}</div>
        <div class="stat-label">Horas acumuladas</div>
    </div>

</div>


<!-- ===============================
     ACCESOS RÃPIDOS SEGÃšN ROL
================================ -->
<h4 class="mb-3">Acciones rÃ¡pidas</h4>
<div class="row quick-actions">

    <div class="col-md-3 mb-3">
        <a href="/fichaje" class="btn btn-primary w-100 p-4">
            ğŸ•’ Registrar asistencia
        </a>
    </div>

    {% if current_user.rol in ['admin','supervisor'] %}
    <div class="col-md-3 mb-3">
        <a href="/reportes/diario" class="btn btn-success w-100 p-4">
            ğŸ“… Reporte diario
        </a>
    </div>

    <div class="col-md-3 mb-3">
        <a href="/reportes/mensual" class="btn btn-success w-100 p-4">
            ğŸ“Š Reporte mensual
        </a>
    </div>
    {% endif %}

    {% if current_user.rol == 'admin' %}
    <div class="col-md-3 mb-3">
        <a href="/empleados" class="btn btn-dark w-100 p-4">
            ğŸ‘¥ Empleados
        </a>
    </div>

    <div class="col-md-3 mb-3">
        <a href="/usuarios" class="btn btn-dark w-100 p-4">
            ğŸ” Usuarios
        </a>
    </div>

    <div class="col-md-3 mb-3">
        <a href="/empresa/configuracion" class="btn btn-secondary w-100 p-4">
            ğŸ¢ Empresa
        </a>
    </div>

    <div class="col-md-3 mb-3">
        <a href="/auditoria" class="btn btn-danger w-100 p-4">
            ğŸ“œ AuditorÃ­a
        </a>
    </div>
    {% endif %}

</div>


<!-- ===============================
     GRÃFICO TENDENCIA
================================ -->
<div class="card shadow-sm p-4 mb-5 chart-card">
    <h4 class="mb-4">Horas trabajadas este mes</h4>
    <canvas id="horasChart"></canvas>
</div>




<!-- ===============================
     SCRIPT GRÃFICO
================================ -->
<script>
const ctx = document.getElementById('horasChart');

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ chart_labels|tojson }},
        datasets: [{
            label: 'Horas trabajadas',
            data: {{ chart_data|tojson }},
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'Horas'
                }
            }
        }
    }
});
</script>

{% endblock %}
